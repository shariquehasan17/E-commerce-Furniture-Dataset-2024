
print("Missing values:\n", df.isnull().sum())
print("\nColumns:", df.columns.tolist())


def clean_price_column(series):
    # remove $ and commas, convert to float where possible
    return series.astype(str).str.replace(r'[\$,]', '', regex=True).str.strip().replace('', np.nan)

if 'price' in df.columns:
    df['price'] = clean_price_column(df['price']).astype(float)

if 'originalPrice' in df.columns:
    df['originalPrice'] = clean_price_column(df['originalPrice']).astype(float)

if 'sold' in df.columns:
    df['sold'] = pd.to_numeric(df['sold'], errors='coerce')

display(df[['price','originalPrice','sold']].describe())

if 'originalPrice' in df.columns:
    df['originalPrice'] = df['originalPrice'].fillna(df['price'])

df['discount_percentage'] = np.where(
    (df['originalPrice'] > 0),
    (df['originalPrice'] - df['price']) / df['originalPrice'] * 100,
    0
)

df['discount_percentage'] = df['discount_percentage'].clip(lower=0)

def simplify_tag(x):
    if pd.isna(x):
        return 'missing'
    x = str(x).strip()
    if 'Free shipping' in x or 'Free' in x:
        return 'free_shipping'
    if '+Shipping:' in x:
        return 'paid_shipping'
    return 'others'

if 'tagText' in df.columns:
    df['tag_simplified'] = df['tagText'].apply(simplify_tag)
    print(df['tag_simplified'].value_counts())


df = df.dropna(subset=['price', 'sold']).reset_index(drop=True)
print("After dropping:", df.shape)







